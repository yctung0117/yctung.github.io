<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>取得手機座標1</title>
    <style>
        #previewModal {
            display: none; /* 隱藏預覽對話框 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        #previewContent {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
    </style>
    <script>
        function getLocationAndSubmit() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    // 將經緯度填入Google表單欄位
                    document.getElementById("latitude").value = position.coords.latitude;
                    document.getElementById("longitude").value = position.coords.longitude;

                    // 顯示預覽對話框
                    showPreview();
                }, function (error) {
                    alert("無法獲取位置：" + error.message);
                });
            } else {
                alert("此瀏覽器不支援地理位置API");
            }
        }

        function showPreview() {
            // 獲取用戶輸入的數據
            var name = document.getElementById("name").value;
            var studentID = document.getElementById("studentID").value;
            var latitude = document.getElementById("latitude").value;
            var longitude = document.getElementById("longitude").value;

            // 顯示預覽信息
            document.getElementById("previewName").textContent = "姓名: " + name;
            document.getElementById("previewStudentID").textContent = "學號: " + studentID;
            document.getElementById("previewLatitude").textContent = "緯度: " + latitude;
            document.getElementById("previewLongitude").textContent = "經度: " + longitude;

            // 隱藏座標的輸入框，顯示座標值
            document.getElementById("latitude").style.display = "none";
            document.getElementById("longitude").style.display = "none";

            // 顯示預覽對話框
            document.getElementById("previewModal").style.display = "flex";
        }

        function confirmSubmit() {
            // 提交表單
            document.getElementById("locationForm").submit();
        }

        function closePreview() {
            // 關閉預覽對話框
            document.getElementById("previewModal").style.display = "none";
        }
    </script>
</head>
<body>
    <h1>請允許我們存取您的位置</h1>

    <form id="locationForm" action="https://docs.google.com/forms/d/e/FORM_ID/formResponse" method="POST" target="_self">
        <!-- 姓名欄位 -->
        <label for="name">姓名:</label>
        <input type="text" id="name" name="entry.NAME_ENTRY_ID" required>
        
        <!-- 學號欄位 -->
        <label for="studentID">學號:</label>
        <input type="text" id="studentID" name="entry.STUDENT_ID_ENTRY_ID" required>
        
        <!-- 隱藏欄位，將座標傳送到Google表單對應的entry ID -->
        <input type="hidden" id="latitude" name="entry.LATITUDE_ENTRY_ID">
        <input type="hidden" id="longitude" name="entry.LONGITUDE_ENTRY_ID">
        
        <!-- 預覽按鈕 -->
        <button type="button" onclick="getLocationAndSubmit()">預覽填入信息</button>
        
        <!-- 提交按鈕（禁用直到預覽確認） -->
        <button type="button" onclick="getLocationAndSubmit()">傳送座標</button>
    </form>

    <!-- 預覽對話框 -->
    <div id="previewModal">
        <div id="previewContent">
            <h2>請確認填入的信息</h2>
            <p id="previewName"></p>
            <p id="previewStudentID"></p>
            <p id="previewLatitude"></p>
            <p id="previewLongitude"></p>
            <button onclick="confirmSubmit()">確認提交</button>
            <button onclick="closePreview()">取消</button>
        </div>
    </div>
</body>
</html>
